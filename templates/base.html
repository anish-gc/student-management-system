<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% load static %}

    <link rel="icon" href="{% static 'admin/images/favicon.svg' %}" type="image/x-icon">
    
    <title>
        {% block title %}{% endblock title %} | {% block default_title_suffix %}Your Site{% endblock default_title_suffix %}
    </title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=swap">
    
    <!-- Ionicons -->
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    
    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'admin/plugins/fontawesome-free/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin/plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
    <link rel="stylesheet" href="{% static 'admin/css/adminlte.min.css' %}">
    
    <!-- Plugin CSS (loaded conditionally) -->
    {% block plugin_css %}
        <link rel="stylesheet" href="{% static 'admin/plugins/toastr/toastr.min.css' %}">
        <link rel="stylesheet" href="{% static 'admin/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css' %}">
        <link rel="stylesheet" href="{% static 'admin/plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
        <link rel="stylesheet" href="{% static 'admin/plugins/daterangepicker/daterangepicker.css' %}">
        <link rel="stylesheet" href="{% static 'admin/plugins/summernote/summernote-bs4.min.css' %}">
        <link rel="stylesheet" href="{% static 'admin/plugins/select2/css/select2.min.css' %}">
        <link rel="stylesheet" href="{% static 'admin/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}">
    {% endblock plugin_css %}
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'admin/css/dataTable.css' %}">
    <link rel="stylesheet" href="{% static 'admin/css/custom.css' %}"/>
    
    <!-- Page-specific CSS -->
    {% block css %}
    <style>
        button:focus,
        input:focus {
            outline: orange solid 5px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                color-scheme: light;
            }
        }

        @media (forced-colors: active) {
            :root {
                color-scheme: light;
            }
        }
    </style>
    {% endblock css %}
    
    <!-- Extra head content -->
    {% block extra_head %}{% endblock extra_head %}
</head>

<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">

        <!-- Preloader -->
        {% include 'includes/preloader.html' %}

        <!-- Navbar -->
        {% include 'includes/navbar.html' %}
        <!-- /.navbar -->

        <!-- Main Sidebar Container -->
        {% include 'includes/sidebar.html' %}
        <!-- sidebar ends here  -->

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            {% block content %}{% endblock content %}
        </div>
        <!-- /.content-wrapper -->

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
        
        <!-- Main Footer -->
        {% include 'includes/footer.html' %}
        
    </div>
    
    <!-- Core JavaScript -->
    <script src="{% static 'admin/plugins/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'admin/plugins/jquery-ui/jquery-ui.min.js' %}"></script>
    <script src="{% static 'admin/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'admin/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
    <script src="{% static 'admin/js/adminlte.js' %}"></script>
    
    <!-- External Libraries with fallbacks -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Fallback for SweetAlert2
        window.Swal2 = window.Swal || function() {
            console.error('SweetAlert2 failed to load');
            return {
                fire: function() { return Promise.resolve({ isConfirmed: false }); },
                // Add other methods as needed
            };
        };
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/9.0.0/decimal.min.js"></script>
    <script>
        // Fallback for decimal.js
        window.Decimal = window.Decimal || {
            // Simple fallback implementation
            // Add basic functionality if needed
        };
    </script>
    
    <!-- Plugin JavaScript (loaded conditionally) -->
    {% block plugin_js %}
        <script src="{% static 'admin/plugins/moment/moment.min.js' %}"></script>
        <script src="{% static 'admin/plugins/daterangepicker/daterangepicker.js' %}"></script>
        <script src="{% static 'admin/plugins/toastr/toastr.min.js' %}"></script>
        <script src="{% static 'admin/plugins/select2/js/select2.full.min.js' %}"></script>
        <script src="{% static 'admin/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js' %}"></script>
        <script src="{% static 'admin/plugins/summernote/summernote-bs4.min.js' %}"></script>
        <script src="{% static 'admin/plugins/sparklines/sparkline.js' %}"></script>
        <script src="{% static 'admin/plugins/jquery-knob/jquery.knob.min.js' %}"></script>
    {% endblock plugin_js %}
    
    <!-- Validation and DataTable -->
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
    <script>
        // Fallback for jQuery Validation
        if (typeof $.fn.validate === 'undefined') {
            $.fn.validate = function() {
                console.error('jQuery Validation failed to load');
                return this;
            };
        }
    </script>
    
    <script src="{% static 'admin/js/dataTable.js' %}"></script>
    
   
    <!-- Custom JavaScript -->
    <script src="{% static 'admin/js/main.js' %}"></script>

    <!-- Alerts -->

    <!-- Page-specific JavaScript -->
    {% block js_files %}{% endblock js_files %}

    <!-- Inline JavaScript -->
    <script>
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Add loaded class for preloader
            document.body.classList.add('loaded');
            
            // Initialize editors if they exist
            if (typeof ClassicEditor !== 'undefined') {
                document.querySelectorAll('.editor').forEach((e) => {
                    ClassicEditor
                        .create(e)
                        .catch(error => {
                            console.error('Editor initialization error:', error);
                        });
                });
            }
            
            // Focus current sidebar link
            var currentURL = window.location.href;
            var sidebarLinks = document.querySelectorAll('.main-sidebar a[href]');
            
            sidebarLinks.forEach(function (link) {
                if (currentURL.includes(link.getAttribute('href'))) {
                    link.classList.add('active');
                    link.setAttribute('aria-current', 'page');
                    link.focus();
                    
                    // Smooth scroll to element if needed
                    if (!isElementInViewport(link)) {
                        link.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            });
            
            // Helper function to check if element is in viewport
            function isElementInViewport(el) {
                var rect = el.getBoundingClientRect();
                return (
                    rect.top >= 0 &&
                    rect.left >= 0 &&
                    rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                    rect.right <= (window.innerWidth || document.documentElement.clientWidth)
                );
            }
        });
    </script>
    
    <!-- Extra JavaScript -->
    {% block extra_js %}{% endblock extra_js %}
</body>

</html>